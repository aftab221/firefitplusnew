function initBSFTrackerJS(){(function(w,d,t,r,u){var f,n,i;w[u]=w[u]||[],f=function(){var o={ti:"17537757"};o.q=w[u],w[u]=new UET(o),w[u].push("pageLoad")},n=d.createElement(t),n.src=r,n.async=1,n.onload=n.onreadystatechange=function(){var s=this.readyState;s&&s!=="loaded"&&s!=="complete"||(f(),n.onload=n.onreadystatechange=null)},i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)})(window,document,"script","//bat.bing.com/bat.js","uetq");window.uetq=window.uetq||[]}
var generateProductIds=function(items,type="bing"){var bsf_pids=[];for(var i=0;i<items.length;i++){var bsf_pid=generateProductItemsId(items[i],type);if(bsf_pid)bsf_pids.push(bsf_pid)}return bsf_pids};var generateProductItemsId=function(items,type="bing"){var bsf_item_pid="shopify_US"+"_"+items.product_id+"_"+items.variant_id;if(parseInt("1")===1)bsf_item_pid=items.sku;else if(parseInt("1")===2)bsf_item_pid=items.variant_id;return bsf_item_pid};
var getShopCurrency=function(items){var bsf_shop_currency="";if(items.shop_currency!="")bsf_shop_currency=items.shop_currency;return bsf_shop_currency};
var getShopProductData=function(items,type){var bsf_shop_pdata="";var bsf_shop_pids=[];for(var i=0;i<items.length;i++){var bsf_item=items[i];if(type=="name"||type=="title")var bsf_shop_pdata=type=="title"?bsf_item.product_title:bsf_item.name;else if(type=="category")var bsf_shop_pdata=bsf_item.category;else if(type=="id")bsf_shop_pids.push(bsf_item.product_id)}return type=="id"?bsf_shop_pids:bsf_shop_pdata};
function bsfCallInitiateCheckout(total_price,shop_currency,cart_item,num_items){window.uetq.push("event","begincheckoutbuttonclick",{"event_category":"BeginCheckout","revenue_value":total_price,"currency":shop_currency})}
var bsfLoadScript=function(url,callback){var script=document.createElement("script");script.type="text/javascript";if(script.readyState)script.onreadystatechange=function(){if(script.readyState=="loaded"||script.readyState=="complete"){script.onreadystatechange=null;callback()}};else script.onload=function(){callback()};script.src=url;document.getElementsByTagName("head")[0].appendChild(script)};
var bsfPrepareAdditionalEvent=function(bsf_jQuery){function prepareAddtoCart(){bsf_jQuery("form[action^='/cart/add']").on("submit",function(e){if(!(e.defaultPrevented||e.isDefaultPrevented&&e.isDefaultPrevented()))triggerAddToCart(false)});var _generic_ajax_open=XMLHttpRequest.prototype.open;var _generic_ajax_send=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(method,url){this._method=method;this._url=url;_generic_ajax_open.apply(this,arguments)};XMLHttpRequest.prototype.send=
function(){this.addEventListener("readystatechange",function(){if(this.readyState===XMLHttpRequest.DONE)if(this._url.indexOf("/cart/add")!==-1){var cart_item=JSON.parse(this.responseText);triggerAddToCart(cart_item)}});_generic_ajax_send.apply(this,arguments)};var _generic_fetch_open=window.fetch;window.fetch=function(){return new Promise((resolve,reject)=>{_generic_fetch_open.apply(this,arguments).then(response=>{if(response.url.indexOf("/cart/add")>-1&&response.status==200)response.clone().json().then(cart_item=>
{if(typeof cart_item.items!="undefined"&&cart_item.items.length>0)cart_item=cart_item.items[0];triggerAddToCart(cart_item)}).catch(err=>{console.log(err)});resolve(response)}).catch(error=>{console.log(error);reject(error)})})}}function prepareCheckout(){bsf_jQuery(":submit",bsf_jQuery("form[action='/cart'],form[action^='/cart?']")).on("click",function(e){if(bsf_jQuery(this).attr("name")=="checkout")triggerCheckout()});bsf_jQuery(document).on("click",".shopify-payment-button,.ucd-checkout-btn",function(e){if(typeof bsf_conversion_data!=
"undefined"&&bsf_conversion_data&&bsf_conversion_data.page_type&&(bsf_conversion_data.page_type=="cart"||bsf_conversion_data.page_type=="product")&&bsf_conversion_data.data.total_price>0){var bsf_shop_currency=getShopCurrency(bsf_conversion_data.data);bsfCallInitiateCheckout(bsf_conversion_data.data.total_price,bsf_shop_currency,bsf_conversion_data.data.product_data,bsf_conversion_data.data.num_items)}else;})}function triggerCheckout(){if(typeof bsf_conversion_data!="undefined"&&bsf_conversion_data&&
bsf_conversion_data.page_type&&bsf_conversion_data.page_type=="cart"&&bsf_conversion_data.data.total_price>0){var bsf_shop_currency=getShopCurrency(bsf_conversion_data.data);bsfCallInitiateCheckout(bsf_conversion_data.data.total_price,bsf_shop_currency,bsf_conversion_data.data.product_data,bsf_conversion_data.data.num_items)}else bsf_jQuery.ajax({type:"GET",url:"https://www.firepitsurplus.com/cart.js?t="+Date.now(),dataType:"json",success:function(response){if(response&&response.total_price&&response.total_price>
0){var cart_total_price=response.total_price/100;var cart_item=response.items;bsfCallInitiateCheckout(cart_total_price,response.currency,cart_item,response.item_count)}}})}function triggerAddToCart(cart_item){var bsf_gtag_args={};if(cart_item){bsf_gtag_args.ecomm_prodid=generateProductIds([cart_item]);bsf_gtag_args.ecomm_totalvalue=parseFloat((cart_item.price/100).toFixed(2));var bsf_prod_ids=getShopProductData([cart_item],"id");var bsf_prod_name=getShopProductData([cart_item],"title")}else if(typeof bsf_conversion_data!=
"undefined"&&bsf_conversion_data&&bsf_conversion_data.data.total_price>0){bsf_gtag_args.ecomm_prodid=generateProductIds(bsf_conversion_data.data.product_data);bsf_gtag_args.ecomm_totalvalue=bsf_conversion_data.data.total_price;var bsf_prod_ids=getShopProductData(bsf_conversion_data.data.product_data,"id");var bsf_prod_name=getShopProductData(bsf_conversion_data.data.product_data,"name")}else console.log("Conversion Tracking Snippet is Missing");if(bsf_gtag_args.ecomm_totalvalue!="undefined"&&bsf_gtag_args.ecomm_totalvalue&&
bsf_gtag_args.ecomm_totalvalue>0){var bsf_bing_retag_args={ecomm_pagetype:"cart"};if(bsf_gtag_args.ecomm_prodid.length>0)bsf_bing_retag_args.ecomm_prodid=bsf_gtag_args.ecomm_prodid;window.uetq.push("event","add_to_cart",bsf_bing_retag_args);var bsf_bing_add_to_cart_args={event_category:"AddToCart",revenue_value:bsf_gtag_args.ecomm_totalvalue};if(typeof bsf_conversion_data!="undefined")bsf_bing_add_to_cart_args.currency=getShopCurrency(bsf_conversion_data.data);window.uetq.push("event","addtocartbuttonclick",
bsf_bing_add_to_cart_args)}}prepareAddtoCart();prepareCheckout()};function bsfLoadjQuery(){if(!window.jQuery||typeof jQuery==="undefined")bsfLoadScript("//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js",function(){bsf_jQuery=jQuery.noConflict(true);bsfPrepareAdditionalEvent(bsf_jQuery)});else bsfPrepareAdditionalEvent(jQuery)}
function initBSFTracker(){bsfLoadjQuery();var bsf_shopify_checkout=Shopify.checkout||[];var bsf_line_items=bsf_shopify_checkout.line_items||[];var is_thank_you_page=0;if(location.href.includes("thank_you")&&Shopify.checkout.total_price&&bsf_line_items.length>0){is_thank_you_page=1;if(Shopify.checkout.presentment_currency&&Shopify.checkout.presentment_currency!="")var currency=Shopify.checkout.presentment_currency;else var currency=Shopify.checkout.currency}if(typeof bsf_conversion_data!="undefined"&&
typeof bsf_conversion_data.page_type!="undefined"&&typeof bsf_conversion_data.event!="undefined"&&bsf_conversion_data.page_type!==""&&bsf_conversion_data.event!==""){var bsf_bing_retag_args={ecomm_pagetype:bsf_conversion_data.page_type,ecomm_totalvalue:bsf_conversion_data.data.total_price};var bsf_bing_ecomm_prodid=generateProductIds(bsf_conversion_data.data.product_data,"bing");if(bsf_bing_ecomm_prodid.length>0)bsf_bing_retag_args.ecomm_prodid=bsf_bing_ecomm_prodid;window.uetq.push("event","",bsf_bing_retag_args)}if(is_thank_you_page==
1){var product_data=[];var total_price=Shopify.checkout.total_price||0;for(i in bsf_line_items){var item=bsf_line_items[i];var p_data={variant_id:item.variant_id,product_id:item.product_id,name:item.title,price:item.price,currency:currency,sku:item.sku,brand:item.vendor,variant:item.variant_title,category:""};product_data.push(p_data)}var bsf_bing_retag_args={ecomm_pagetype:"purchase"};var bsf_bing_ecomm_prodid=generateProductIds(product_data,"bing");if(bsf_bing_ecomm_prodid.length>0)bsf_bing_retag_args.ecomm_prodid=
bsf_bing_ecomm_prodid;window.uetq.push("event","",bsf_bing_retag_args)}if(is_thank_you_page==1){var total_price=Shopify.checkout.total_price||0;window.uetq.push("event","",{"revenue_value":total_price,"currency":currency})}}(function(){initBSFTrackerJS();initBSFTracker()})();
